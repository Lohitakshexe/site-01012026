<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wannabe crazy lover | Gallery</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>

<body>
    <div class="ambient-light"></div>

    <header style="position: fixed; top: 0; width: 100%; padding: 2rem 0; z-index: 100; backdrop-filter: blur(5px);">
        <nav class="container" style="display: flex; justify-content: space-between; align-items: center;">
            <a href="index.html" class="logo"
                style="text-decoration: none; font-weight: 800; font-size: 1.5rem; letter-spacing: -0.5px; color: var(--text-primary);">
                wannabe <span class="gradient-text">crazy lover</span>
            </a>
            <div class="nav-links" style="display: flex; gap: 2rem; color: var(--text-secondary);">
                <a href="index.html"
                    style="color: inherit; text-decoration: none; font-weight: 500; transition: color 0.3s;">Home</a>
            </div>
        </nav>
    </header>

    <main class="container" style="padding-top: 8rem; padding-bottom: 4rem;">
        <h1 class="gradient-text" style="font-size: 3rem; margin-bottom: 2rem;">Gallery</h1>

        <div class="folder-grid"
            style="display: flex; justify-content: center; align-items: center; flex-wrap: wrap; margin-bottom: 4rem;">
            <!-- Screenshots Folder -->
            <div class="folder-item" onclick="window.location.href='screenshots.html'">
                <div class="folder-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                    </svg>
                </div>
                <span class="folder-name">Screenshots</span>
            </div>
        </div>

        <!-- Pinned Section -->
        <div id="pinned-section" style="opacity: 0; transition: opacity 1s ease; margin-bottom: 4rem;">
            <h2 class="gradient-text" style="font-size: 2rem; margin-bottom: 2rem; text-align: center;">Pinned</h2>

            <div id="pinned-container"
                style="display: flex; gap: 1.5rem; flex-direction: row; align-items: flex-start;">
                <div class="pinned-column" style="flex: 1; display: flex; flex-direction: column; gap: 1.5rem;"></div>
                <div class="pinned-column" style="flex: 1; display: flex; flex-direction: column; gap: 1.5rem;"></div>
                <div class="pinned-column" style="flex: 1; display: flex; flex-direction: column; gap: 1.5rem;"></div>
                <div class="pinned-column" style="flex: 1; display: flex; flex-direction: column; gap: 1.5rem;"></div>
            </div>
        </div>

        <!-- Photos Section -->
        <div id="photos-section" style="opacity: 0; transition: opacity 1s ease;">
            <h2 class="gradient-text" style="font-size: 2rem; margin-bottom: 2rem; text-align: center;">Photos</h2>

            <div id="photos-container"
                style="display: flex; gap: 1.5rem; flex-direction: row; align-items: flex-start;">
                <div class="photo-column" style="flex: 1; display: flex; flex-direction: column; gap: 1.5rem;"></div>
                <div class="photo-column" style="flex: 1; display: flex; flex-direction: column; gap: 1.5rem;"></div>
                <div class="photo-column" style="flex: 1; display: flex; flex-direction: column; gap: 1.5rem;"></div>
                <div class="photo-column" style="flex: 1; display: flex; flex-direction: column; gap: 1.5rem;"></div>
            </div>
        </div>
    </main>

    <!-- Lightbox Modal -->
    <div id="lightbox" class="lightbox-overlay" onclick="closeLightbox()">
        <div class="lightbox-close">&times;</div>
        <img id="lightbox-img" class="lightbox-image" src="" alt="Full size">
    </div>

    <script src="main.js"></script>


    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const allImages = []; // Global store for all rendered images
            let currentIndex = -1;

            // Lightbox Logic
            const lightbox = document.getElementById('lightbox');
            const lightboxImg = document.getElementById('lightbox-img');

            function openLightbox(index) {
                currentIndex = index;
                updateLightboxImage();
                lightbox.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            function updateLightboxImage() {
                if (currentIndex < 0 || currentIndex >= allImages.length) return;
                const imgData = allImages[currentIndex];
                const src = imgData.src; // Already fully qualified path stored
                lightboxImg.src = src;
            }

            function navigate(direction) {
                currentIndex += direction;
                if (currentIndex < 0) currentIndex = allImages.length - 1;
                if (currentIndex >= allImages.length) currentIndex = 0;
                updateLightboxImage();
            }

            window.closeLightbox = function () {
                lightbox.classList.remove('active');
                document.body.style.overflow = 'auto';
                setTimeout(() => {
                    lightboxImg.src = '';
                }, 300);
            }

            // Navigation Buttons
            const prevBtn = document.createElement('button');
            prevBtn.innerHTML = '&#10094;';
            prevBtn.style.position = 'absolute';
            prevBtn.style.top = '50%';
            prevBtn.style.left = '2rem';
            prevBtn.style.transform = 'translateY(-50%)';
            prevBtn.style.background = 'rgba(0,0,0,0.5)';
            prevBtn.style.color = 'white';
            prevBtn.style.border = 'none';
            prevBtn.style.padding = '1rem';
            prevBtn.style.cursor = 'pointer';
            prevBtn.style.fontSize = '2rem';
            prevBtn.style.borderRadius = '50%';
            prevBtn.style.zIndex = '10001';
            prevBtn.onclick = (e) => { e.stopPropagation(); navigate(-1); };
            lightbox.appendChild(prevBtn);

            const nextBtn = document.createElement('button');
            nextBtn.innerHTML = '&#10095;';
            nextBtn.style.position = 'absolute';
            nextBtn.style.top = '50%';
            nextBtn.style.right = '2rem';
            nextBtn.style.transform = 'translateY(-50%)';
            nextBtn.style.background = 'rgba(0,0,0,0.5)';
            nextBtn.style.color = 'white';
            nextBtn.style.border = 'none';
            nextBtn.style.padding = '1rem';
            nextBtn.style.cursor = 'pointer';
            nextBtn.style.fontSize = '2rem';
            nextBtn.style.borderRadius = '50%';
            nextBtn.style.zIndex = '10001';
            nextBtn.onclick = (e) => { e.stopPropagation(); navigate(1); };
            lightbox.appendChild(nextBtn);

            document.addEventListener('keydown', (e) => {
                if (!lightbox.classList.contains('active')) return;
                if (e.key === 'Escape') closeLightbox();
                if (e.key === 'ArrowLeft') navigate(-1);
                if (e.key === 'ArrowRight') navigate(1);
            });


            // Delay showing photos for 3 seconds
            setTimeout(() => {
                const photosSection = document.getElementById('photos-section');
                const pinnedSection = document.getElementById('pinned-section');

                if (pinnedSection) {
                    pinnedSection.style.opacity = '1';
                    loadPinned();
                }

                if (photosSection) {
                    setTimeout(() => {
                        photosSection.style.opacity = '1';
                        loadPhotos();
                    }, 500); // Slight stagger for photos after pinned
                }
            }, 3000);

            async function loadPinned() {
                const columns = document.querySelectorAll('.pinned-column');
                if (!columns.length) return;

                const columnHeights = new Array(columns.length).fill(0);

                try {
                    const response = await fetch(`gallery/pinned.json?t=${Date.now()}`);
                    const images = await response.json();

                    if (images.length === 0) {
                        document.getElementById('pinned-container').innerHTML = '<p style="text-align: center; width: 100%; color: var(--text-secondary);">No pinned (yet).</p>';
                        return;
                    }

                    renderImages(images, columns, columnHeights, 'gallery/pinned');
                } catch (error) {
                    console.error('Failed to load pinned:', error);
                    document.getElementById('pinned-container').innerHTML = '<p style="text-align: center; width: 100%; color: var(--text-secondary);">Failed to load pinned images.</p>';
                }
            }

            // Refactored render function to reuse for both sections
            function renderImages(images, columns, columnHeights, basePath) {
                images.forEach((imgData, index) => {
                    // Create full image object for lightbox
                    const src = typeof imgData === 'string' ? imgData : imgData.name;
                    const mtime = imgData.mtime || Date.now();
                    const fullSrc = `${basePath}/${src}?v=${mtime}`;

                    // Add to global collection and get index
                    const globalIndex = allImages.length;
                    allImages.push({ src: fullSrc });

                    const div = document.createElement('div');
                    div.className = 'gallery-item animate-fade-in';
                    div.style.opacity = '0';
                    div.style.transform = 'translateY(20px)';
                    div.style.transition = 'all 0.5s ease';
                    div.style.transitionDelay = `${Math.min(index * 0.05, 1.0)}s`;
                    div.style.borderRadius = 'var(--border-radius-md)';
                    div.style.overflow = 'hidden';
                    div.style.backgroundColor = 'var(--glass-bg)';

                    const width = imgData.width || 100;
                    const height = imgData.height || 100;
                    const aspectRatio = height / width;

                    const imageElement = document.createElement('img');
                    imageElement.src = fullSrc;
                    imageElement.alt = src;
                    imageElement.loading = 'lazy';
                    imageElement.style.width = '100%';
                    imageElement.style.height = 'auto';
                    imageElement.style.display = 'block';
                    imageElement.style.cursor = 'zoom-in';
                    imageElement.style.transition = 'transform 0.5s ease';

                    imageElement.onclick = () => openLightbox(globalIndex);
                    div.onmouseenter = () => imageElement.style.transform = 'scale(1.05)';
                    div.onmouseleave = () => imageElement.style.transform = 'scale(1)';

                    div.appendChild(imageElement);

                    let shortestColumnIndex = 0;
                    let minHeight = columnHeights[0];

                    for (let i = 1; i < columnHeights.length; i++) {
                        if (columnHeights[i] < minHeight) {
                            minHeight = columnHeights[i];
                            shortestColumnIndex = i;
                        }
                    }

                    columns[shortestColumnIndex].appendChild(div);
                    columnHeights[shortestColumnIndex] += aspectRatio;

                    requestAnimationFrame(() => {
                        div.style.opacity = '1';
                        div.style.transform = 'translateY(0)';
                    });
                });
            }

            async function loadPhotos() {
                const columns = document.querySelectorAll('.photo-column');
                const columnHeights = new Array(columns.length).fill(0);

                try {
                    const response = await fetch(`gallery/photos.json?t=${Date.now()}`);
                    const images = await response.json();

                    if (images.length === 0) {
                        document.getElementById('photos-container').innerHTML = '<p style="text-align: center; width: 100%; color: var(--text-secondary);">No photos found.</p>';
                        return;
                    }

                    renderImages(images, columns, columnHeights, 'photos');
                } catch (error) {
                    console.error('Failed to load photos:', error);
                    document.getElementById('photos-container').innerHTML = '<p style="text-align: center; width: 100%; color: var(--text-secondary);">No photos found or failed to load.</p>';
                }
            }
        });
    </script>

    <!-- Flower Decorations -->
    <div class="flower-decorations">
        <!-- Left Cluster -->
        <svg class="flower-left" viewBox="0 0 200 300" xmlns="http://www.w3.org/2000/svg">
            <g class="flower-interactive">
                <path class="flower-stem" d="M40,300 Q60,200 40,150" />
                <path class="flower-petal"
                    d="M40,150 C10,120 10,180 40,150 M40,150 C70,120 70,180 40,150 M40,150 C40,110 10,110 40,150 M40,150 C40,110 70,110 40,150" />
                <text x="40" y="130" class="flower-text">koffee</text>
            </g>

            <g class="flower-interactive">
                <path class="flower-stem" d="M100,300 Q90,220 120,160" />
                <path class="flower-petal"
                    d="M120,160 C90,130 90,190 120,160 M120,160 C150,130 150,190 120,160 M120,160 C120,120 90,120 120,160 M120,160 C120,120 150,120 120,160" />
                <text x="120" y="200" class="flower-text">honeypie</text>
            </g>

            <g class="flower-interactive">
                <path class="flower-stem" d="M70,300 Q80,260 70,240" />
                <path class="flower-petal" d="M70,240 C55,225 55,255 70,240 M70,240 C85,225 85,255 70,240" />
                <text x="70" y="270" class="flower-text">sweet sugar bun</text>
            </g>
        </svg>

        <!-- Right Cluster -->
        <svg class="flower-right" viewBox="0 0 200 300" xmlns="http://www.w3.org/2000/svg">
            <g class="flower-interactive">
                <path class="flower-stem" d="M150,300 Q130,220 160,140" />
                <path class="flower-petal"
                    d="M160,140 C130,110 130,170 160,140 M160,140 C190,110 190,170 160,140 M160,140 C160,100 130,100 160,140 M160,140 C160,100 190,100 160,140" />
                <text x="160" y="120" class="flower-text">beauty personified</text>
            </g>

            <g class="flower-interactive">
                <path class="flower-stem" d="M100,300 Q120,240 90,180" />
                <path class="flower-petal"
                    d="M90,180 C60,150 60,210 90,180 M90,180 C120,150 120,210 90,180 M90,180 C90,140 60,140 90,180 M90,180 C90,140 120,140 90,180" />
                <text x="90" y="220" class="flower-text">angry bird</text>
            </g>
        </svg>
    </div>
</body>

</html>